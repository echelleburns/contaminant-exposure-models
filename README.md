# Description
This repository contains the code used in the paper that is currently under review: Using acoustic telemetry to quantify potential contaminant exposure of Vermilion Rockfish (Sebastes miniatus), Hornyhead Turbot (Pleuronichthys verticalis), and White Croaker (Genyonemus lineatus) at wastewater outfalls in southern California 

Raw and final datasets have been uploaded to Dryad.

**Note**: WC = white croaker; HT = hornyhead turbot; VR = vermilion rockfish

# Folder Schema
Please ensure that your folder schema is the same as described below to ensure that all codes run appropriately. Most data files mentioned are generated by the code; only files in `data/shapefiles`, `data/true-contaminants`, and `data/all-detections` are required as input. Directions on how to find and download the input datasets is described below.

## Overview
+ `data`
  - `shapefiles`: input
  - `true-contaminants`: input
  - `all-detections`: input
  - `crawl`: output
  - `behaviors`: otuput
  - `CEMs`: output
  - `dist-estimates`: output
  - `kde-weighted`: output
+ `scripts`
  - `functions`
  - `white-croaker`
  - `vermilion-rockfish`
  - `hornyhead-turbot`
+ `figures`
  - `white-croaker`
  - `vermilion-rockfish`
  - `hornyhead-turbot`

## Detailed List
+ `data`: should include all datasets used and created for this project
  - `shapefiles`: contains the shapefiles for the sediment-bound contaminant layers
    - `total_ddt_pv.shp` (and associated shapefiles): DDT concentrations along the Palos Verdes Shelf, CA (USA), which was generated by the USEPA. Station data can be found within the report referenced below.
      - ITSI-Gilbane, C.-S. (2013). Revised Final Data Report for the Fall 2009 Sediment Sampling Program. Prepared for the United States Environmental Protection Agency Region IX. EPA Contract No. EP-S9-08-03 Task Order No. 0029. Retrieved from https://semspub.epa.gov/work/09/100016664.pdf
    - `total_ddt_ocsd.shp` (and associated shapefiles): DDT concentrations along the OCSD outfall (CA, USA), which was generated from the mean of sediment-bound contaminant concentrations at 39 annual sampling sites from 2013-2016. Station data can be found within the OCSD annual reports, referenced below.
      - OCSD. (2014). Ocean Monitoring Annual Report: Year 2012-2013. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-687
      - OCSD. (2015). Ocean Monitoring Annual Report: Year 2013-2014. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-748
      - OCSD. (2016). Ocean Monitoring Annual Report: Year 2014-2015. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-792
      - OCSD. (2017). Ocean Monitoring Annual Report: Year 2015-2016. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-833
      - OCSD. (2018). Ocean Monitoring Annual Report: Year 2016-2017. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-915
    - `total_pcb_ocsd.shp` (and associated shapefiles): PCB concentrations along the OCSD outfall (CA, USA), which was generated from the mean of sediment-bound contaminant concentrations at 39 annual sampling sites from 2013-2016. Station data can be found within the OCSD annual reports, referenced below.
      - OCSD. (2014). Ocean Monitoring Annual Report: Year 2012-2013. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-687
      - OCSD. (2015). Ocean Monitoring Annual Report: Year 2013-2014. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-748
      - OCSD. (2016). Ocean Monitoring Annual Report: Year 2014-2015. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-792
      - OCSD. (2017). Ocean Monitoring Annual Report: Year 2015-2016. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-833
      - OCSD. (2018). Ocean Monitoring Annual Report: Year 2016-2017. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-915
  - `true-contaminants`: includes contaminant data collected from field samples
     - `white_croaker_contaminants.csv`: DDT contaminant concentrations in white croaker tissues, which can be accessed by the DIVER network. Explicit instructions on how to access the exact dataset used for these analyses can be found in the Supplemental Materials of the manuscript itself.
        - DIVER. 2020. Web Application: Data Integration Visualization Exploration and Reporting Application, National Oceanic and Atmospheric Administration. Retrieved: March 20, 2021, from https://www.diver.orr.noaa.gov
     - `vermilion_rockfish_contaminants.csv`: DDT and PCB contaminant concentrations in vermilion rockfish muscle tissues analyzed by the OCSD from the 2016-2017 and 2017-2018 sampling seasons. Means and ranges of contaminant concentrations can be found within the OCSD annual reports, referenced below.
        - OCSD. (2017). Ocean Monitoring Annual Report: Year 2015-2016. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-833
        - OCSD. (2018). Ocean Monitoring Annual Report: Year 2016-2017. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-915
     - `hornyhead_turbot_contaminants.csv`: DDT and PCB contaminant concentrations in hornyhead turbot liver and muscle tissues analyzed by the OCSD from the 2016-2017 and 2017-2018 sampling seasons. Means and ranges of contaminant concentrations can be found within the OCSD annual reports, referenced below.
        - OCSD. (2017). Ocean Monitoring Annual Report: Year 2015-2016. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-833
        - OCSD. (2018). Ocean Monitoring Annual Report: Year 2016-2017. Retrieved from https://www.ocsd.com/about-us/transparency/annual-reports/-folder-915
  - `all-detections`: all VPS rendered positions for species used in the study, truncated to HPE > 15 and the first 24-hours post-tagging removed; all data has been posted to Dryad with readme files for reference
     - `white_croaker_detections.csv`: for white croaker
     - `vermilion_rockfish_detections.csv`: for vermilion rockfish
     - `hornyhead_turbot_detections.csv`: for hornyhead turbot
  - `crawl`: contains the outputs for all model runs (2 min and 5 min interpolations) from the crawl simulation for all species (files created in code `001_continuous-time_correlated_random_walk.R` in each respective species script folder)
    - `*_model_estimates.csv`: the estimated output of tau, sigma, and beta for each iteration (n = 6) of each tagged individual, where * indicates the species (WC, HT, VR)
    - `*_2min-interpolations.csv`: the estimated locations of the third simluation for each individual at 2 min intervals, where * indicates the species (WC, HT, VR)
    - `*_5min-interpolations.csv`: the estimated locations of the third simluation for each individual at 5 min intervals, where * indicates the species (WC, HT, VR)
  - `behaviors`: contains the output for behavioral movement classifications that are defined using the `crawl` data outputs within the `003_movement-models.R`
    - `*_states-**mpermin-***min.csv`: the estimated behavioral state estimated at each location at each time step, where * indicates the species (WC, HT, VR), ** indicates the rate of movement threshold (1 m/min or 3 m/min), and *** indicates the crawl temporal resolution (2 or 5 min)
  - `CEMs`: contains the output for the CEM models using the data from the `behaviors` folder within the `004_CEM.R`
    - `raw_*_CEM_**.csv`: the raw output for the CEM models, where * indicates the species (WC, HT, VR) and ** indicates the contaminant (DDT or PCB)
    - `scaled_*_CEM_**.csv: the sum of the output for the CEM models, for both unscaled (no behavioral scaling) and scaled (scaled by behavioral state) scenarios, where * indicates the species (WC, HT, VR) and ** indicates the contaminant (DDT or PCB)
  - `dist-estimates`: contains the estimates of the underlying distributions for the true contaminant data (`data/true-contaminants/`) and the generated contaminant exposure models (`data/CEMs/scaled*`) from `005_distribution-plots.R`
    - `*-**-***mpermin-****min-notscaled_dist-estimates.csv`: the model outputs where * indicates the species (WC, HT, VR), ** indicates the contaminant (DDT or PCB), *** indicates the rate of movement threshold (1 m/min or 3 m/min), and **** indicates the crawl temporal resolution (2 or 5 min)
    - `*-**_***.png`: figure outputs of model fits where * indicates the species (WC, HT, VR), ** indicates the contaminant (DDT or PCB), and *** indicates the fit distribution
  - `kde-weighted`: contains the outputs of KDEs generated from the data in `007_kde-weighted.R`
    - `*_**mpermin-***min_CEM_****.tiff`: KDE outputs where * indicates the species (WC, HT, VR), ** indicates the rate of movement threshold (1 m/min or 3 m/min), *** indicates the crawl temporal resolution (2 or 5 min), and **** indicates the contaminant (ddt or pcn)
+ `scripts`: includes all codes
  - `functions`: includes all functions created
    - `func-dist_finder.R`: function create to find the best fit distribution for the datasets
    - `comparing-functions.R`: contains functions `scale_for_ks()` which calculates a z-score from the best fitting underlying distribution for scaling prior to putting the data into a KS test; and `create_plots()` which generates a series of distribution plots for the data specified
  - `white-croaker`: includes all codes run for white croaker analyses
    - `001_crawl.R`: takes the raw data from `all-detections` and creates crawl outputs at 2 and 5 min intervals
    - `002_model_fitting.Rmd/002_model_fitting.nb.html`: plots the third simulation from the crawl dataset to ensure results look appropriate
    - `003_movement_models`: categorizes the data from the `data/crawl` into non-moving, random movement, or directional movement and saves the outputs to the `data/behaviors/` folder
    - `004_CEM.R`: uses the combination of the shapefiles containing sediment-bound contaminant concentrations, `data/crawl` and `data/behavior` outputs to calculate the potential for contaminant exposure using time-area metrics
    - `005_distribution_plots.R`: calculates the underlying distributions for true contaminant data (`data/true-contaminants/`) and the generated contaminant exposure models (`data/CEMs/scaled*`)
    - `006_plots_stats.Rmd/006_plots_stats.nb.html`: conducts KS tests for the resulting datasets
    - `007_kde_weighted.R`: creates spatial kernel density estimates for all data, weighted by underlying sediment contaminant concentration
  - `vermilion-rockfish`: includes all codes run for vermilion rockfish analyses
    - `001_crawl.R`
    - `002_model_fitting.Rmd/002_model_fitting.nb.html`
    - `003_movement_models`
    - `004_CEM.R`
    - `005_distribution_plots.R`
    - `006_plots_stats.Rmd/006_plots_stats.nb.html`
    - `007_kde_weighted.R`
  - `hornyhead-turbot`: includes all codes run for hornyhead turbot analyses
    - `001_crawl.R`
    - `002_model_fitting.Rmd/002_model_fitting.nb.html`
    - `003_movement_models`
    - `004_CEM.R`
    - `005_distribution_plots.R`
    - `006_plots_stats.Rmd/006_plots_stats.nb.html`
    - `007_kde_weighted.R`
+ `figures`: contains output figures
  - `white-croaker`: includes output figures for white croaker
  - `vermilion-rockfish`: includes output figures for vermilion rockfish
  - `hornyhead-turbot`: includes output figures for hornyhead turbot
 
# R Version
All code was run using RStudio version 1.1.463, R version 4.0.1 on a device running Windows 10 Home.

# Required Libraries
+ Data Cleaning and Visualization
  - `tidyverse` (version 1.3.0)
  - `readxl` (version 1.3.1)
  - `reshape` (version 0.8.8)
  - `field`s (version 11.6)
+ Geospatial Data Ingestion
  - `rgdal` (version 1.5-18)
  - `spatstat` (version 1.64-1)
  - `geosphere` (version 1.5-10)
  - `maptools` (version 1.0-2)
  - `raster` (version 3.3-13)
+ Distribution Fitting/Statistical Analyses
  - `fitdistrplus` (version 1.1-1)
  - `limma` (version 3.46.0)
+ Track Interpolation
  - `crawl` (version 2.2.1)
+ Movement Models
  - `moveHMM` (version 1.7)
+ Kernel Density Estimates
  - `spatialEco` (version 1.3-2)
